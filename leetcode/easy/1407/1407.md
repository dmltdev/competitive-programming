# LeetCode 1407: Top Travellers

## Problem Summary
Calculate total distance traveled by each user and rank them. Include users with 0 rides.

## Solution 1: CTE with LEFT JOIN
```sql
WITH SummedDistance AS (
    SELECT 
       user_id,
       SUM(distance) as travelled_distance
    FROM Rides
    GROUP BY user_id
)
SELECT 
    u.name, 
    COALESCE(sd.travelled_distance, 0) as travelled_distance
FROM Users u
LEFT JOIN SummedDistance sd ON u.id = sd.user_id
ORDER BY travelled_distance DESC, u.name ASC;
```

**How it works:**
1. **CTE aggregates rides** - Groups rides by user_id and sums distances
2. **LEFT JOIN preserves all users** - Ensures users without rides appear in result
3. **COALESCE handles NULLs** - Converts NULL to 0 for users with no rides
4. **ORDER BY** - First by distance (DESC), then by name (ASC) for ties

**Why LEFT JOIN?** 
- INNER JOIN would exclude Donald (no rides)
- LEFT JOIN keeps all users from the left table (Users)

## Solution 2: Direct Aggregation (Simpler)
```sql
SELECT 
    u.name,
    COALESCE(SUM(r.distance), 0) as travelled_distance
FROM Users u
LEFT JOIN Rides r ON u.id = r.user_id
GROUP BY u.id, u.name
ORDER BY travelled_distance DESC, u.name ASC;
```

**How it works:**
1. **LEFT JOIN first** - Connects users to their rides (preserves all users)
2. **GROUP BY user** - Aggregates rides per user
3. **SUM with COALESCE** - Sums distances, converts NULL to 0
4. **No CTE needed** - Single query does everything

**Why this works:**
- When Donald (no rides) is joined, `r.distance` is NULL
- `SUM(NULL)` returns NULL
- `COALESCE(NULL, 0)` returns 0

## Key Concepts

**NULL Handling:**
- `SUM(NULL)` â†’ NULL (not 0!)
- Always use `COALESCE(expression, 0)` when NULLs are possible

**JOIN Types:**
- `INNER JOIN` - Only matching rows
- `LEFT JOIN` - All rows from left table + matches from right

**GROUP BY with Joins:**
- When aggregating after a join, group by the primary key or unique identifier
- Include all non-aggregated columns in GROUP BY

## Common Mistakes

1. **Using INNER JOIN** - Loses users without rides
2. **Forgetting COALESCE** - Shows NULL instead of 0
3. **Wrong ORDER BY** - Must order by distance DESC first, then name ASC
4. **Not grouping by both id and name** - Some SQL dialects require all selected non-aggregated columns in GROUP BY

## Time Complexity
- O(n + m) where n = users, m = rides
- Both solutions have same performance

## When to Use Each Approach
- **CTE (Solution 1)** - Better readability for complex queries, easier to debug
- **Direct (Solution 2)** - More concise, fewer temporary tables, slightly faster

Both are correct. Choose based on your preference for readability vs. brevity.